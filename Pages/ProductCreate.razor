@page "/create-product"
@attribute [Authorize(Roles = "Employee")]

@using PickupExpressApp.Client.DTOs
@using PickupExpressApp.Client.Services
@inject IProductService ProductService
@inject NavigationManager Navigation

<h3 class="mb-3">Create Product</h3>

@if (!string.IsNullOrEmpty(error))
{
    <div class="alert alert-danger">@error</div>
}

@if (!string.IsNullOrEmpty(successMessage))
{
    <div class="alert alert-success">@successMessage</div>
}

<EditForm Model="@createModel" OnValidSubmit="CreateProduct">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label class="form-label">Name</label>
        <InputText class="form-control" @bind-Value="createModel.Name" />
    </div>

    <div class="mb-3">
        <label class="form-label">Price</label>
        <InputNumber class="form-control" @bind-Value="createModel.Price" />
    </div>

    <div class="mb-3">
        <label class="form-label">Description</label>
        <InputTextArea class="form-control" @bind-Value="createModel.Description" />
    </div>

    <div class="mb-3">
        <label class="form-label">Quantity In Stock</label>
        <InputNumber class="form-control" @bind-Value="createModel.QuantityInStock" />
    </div>

    <div class="d-flex gap-2">
        <button class="btn btn-success" type="submit">Create Product</button>
        <button class="btn btn-secondary" type="button" @onclick="GoBack">Cancel</button>
    </div>
</EditForm>

@code {
    private ProductCreateDto createModel = new();
    private string? error;
    private string? successMessage;

    private async Task CreateProduct()
    {
        try
        {
            var product = await ProductService.CreateProductAsync(createModel);

            if (product != null)
            {
                successMessage = "Product created successfully!";
                Navigation.NavigateTo("/inventory");
            }
            else
            {
                error = "Failed to create product.";
            }
        }
        catch (Exception ex)
        {
            error = "Error creating product: " + ex.Message;
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/inventory");
    }
}
